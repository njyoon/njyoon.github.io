<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Crossword PDF Editor</title>

    <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
    
    <link
      rel="stylesheet"
      href="css/bootstrap.min.css"
    />
    
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet">

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-L1FXWP7B18"></script>
    <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-L1FXWP7B18');
    </script>

    <style>
    html {margin-left: calc(100vw - 100%);}
    head{height:100%}
    body{
        background-color:#fcfcfc;
    }
    h1 {
        color:#06AED5;
        font-size:2rem;
        font-weight:bold;
    }

    h4 {
        font-size:1.1rem;
        color:#686868;
    }

    .material-icons { 
        font-size: 24px; 
        vertical-align: bottom;
    }

    .collapsible-link {
    width: 100%;
    position: relative;
    text-align: left;
    }

    .collapsible-link::before {
    content: '\e5cf';
    position: absolute;
    top: 50%;
    right: 0.8rem;
    transform: translateY(-50%);
    display: block;
    font-family: 'Material Icons';
    font-size: 1.1rem;
    }

    .collapsible-link[aria-expanded='true']::before {
    content: '\e5ce';
    }

    .plus-link {
    width: 100%;
    position: relative;
    }

    .plus-link::before {
    content: '\e145';
    position: absolute;
    font-family: 'Material Icons';
    font-size: 1rem;
    left: -0.3rem;
    transform: translateY(-5%);
    }

    .plus-link[aria-expanded='true']::before {
    content: '\e15b';
    }

    ::placeholder {
        color:lightgrey;
    }

    .pdfobject-container { 
        height: 40rem; 
    }

    .btn.focus,.btn:active.focus,.btn.active {
        box-shadow: none;
        outline: none;
    }

    .nyt {
        color:#f55d4b;
        border-color:#f55d4b;
    }

    .nyt:hover {
        background-color:#f55d4b;
        border-color:#f55d4b;
    }

    
    input[type=file] {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    width: 250px;
    }
    
    </style>


  </head>

  <body>
    <div class="container pt-3">
        <div class="row">
            <div class="col-12 col-lg-9"><h1>Crossword PDF Editor</h1></div>
            <div class="d-none d-lg-block col-lg-3"><a type="button" href="nyt" class="btn btn-outline-danger rounded-pill shadow-none nyt float-right"><b>NYT Submission Editor</b></a></div>
        </div>
        <h4 class="pt-1 pb-1">This tool adds some additional editing options to Crossword Nexus's <a href="https://crosswordnexus.com/apps/puz-to-pdf/">PUZ to PDF Converter</a>.  To get started, just select a puzzle file and click "Preview PDF".  Limited documentation available <a href="https://github.com/njyoon/njyoon.github.io#readme">here.</a></h4>
      <hr>
      <div class="row pt-1 pb-5">

          <div class="col-12 col-lg-4">

              <div class="accordion shadow" id="accordionMain">
                    <form>
                        <div class="card">
                            <div class="card-header bg-white shadow-sm border-0" id="headingOne">
                                
                                    <a data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne" class="btn btn-link text-dark font-weight-bold text-uppercase collapsible-link">
                                        Choose File 
                                    </a> 
                             
                            </div>
                            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionMain">
                                <div class="card-body mx-2 px-4 pt-3 pb-2">
                                    <div class="form-group">   
                                        <label for="files">Select your puzzle file to export as a PDF:</label>
                                        <input type="file" accept=".puz,.xml,.jpz,.xpz,.ipuz" class="form-control-file" id="files" name="files">
                                    </div>  
                                </div>
                            </div>
                        </div>


                        <div class="card">
                            <div id="headingTwo" class="card-header bg-white shadow-sm border-0">
                         
                                    <a data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo" class="btn btn-link collapsed text-dark font-weight-bold text-uppercase collapsible-link">Header Content</a>
                             
                            </div>
                            <div id="collapseTwo" aria-labelledby="headingTwo" data-parent="#accordionMain" class="collapse">
                                <div class="card-body mx-2 px-4 py-3">

                                    <div class="form-group">
                                        <label for="headerText">Main Header Content </label>
                                        <div class="btn-group btn-group-toggle pl-2 pb-2" data-toggle="buttons">

                                            <label class="btn btn-outline-primary active p-0" id="header-left-button">
                                                <input type="radio" id="header-left" name="header-align" checked><span class="material-icons">format_align_left</span>
                                            </label>
                                            <label class="btn btn-outline-primary p-0" id="header-center-button">
                                                <input type="radio" id="header-center" name="header-align"><span class="material-icons">format_align_center</span>
                                            </label>    

                                        </div>
                                        <textarea class="form-control pv-2 pl-3 pr-2 col-10" id="headerText" rows="2" placeholder='Empty field will default to title from puz file'></textarea>
                                    </div>

                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input" id="useHeader2" checked>
                                        <label class="custom-control-label" for="useHeader2">Add Right Header Content</label>
                                    </div>

                                    
                                    <div class="form-group pt-2 pb-2 mb-0 collapse show" id="additional-header">
                                        <div class="btn-group btn-group-toggle pb-2" data-toggle="buttons">

                                            <label class="btn btn-outline-primary p-0" id="header2-left-button">
                                                <input type="radio" id="header2-left" name="header2-align"><span class="material-icons" aria-hidden="true">format_align_left</span>
                                            </label>    
                                            <label class="btn btn-outline-primary active p-0" id="header2-right-button">
                                                <input type="radio" id="header2-right" name="header2-align" checked><span class="material-icons" aria-hidden="true">format_align_right</span>
                                            </label>    

                                        </div>
                                        <div class="btn-group btn-group-toggle pl-2 pb-2" data-toggle="buttons">

                                            <label class="btn btn-outline-primary p-0" id="header2-top-button">
                                                <input type="radio" id="header2-top" name="header2-vAlign"><span class="material-icons" aria-hidden="true">vertical_align_top</span>
                                            </label>
                                            <label class="btn btn-outline-primary p-0" id="header2-middle-button">
                                                <input type="radio" id="header2-middle" name="header2-vAlign"><span class="material-icons" aria-hidden="true">vertical_align_center</span>
                                            </label>   
                                            <label class="btn btn-outline-primary active p-0" id="header2-bottom-button">
                                                <input type="radio" id="header2-bottom" name="header2-vAlign" checked><span class="material-icons" aria-hidden="true">vertical_align_bottom</span>
                                            </label>    

                                        </div>
                                        <textarea class="form-control pv-2 pl-3 pr-2 mb-0 col-10" id="headerText2" rows="2" placeholder='Empty field will default to author from puz file'></textarea>
                                    </div>

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="useSubheader">
                                        <label class="custom-control-label" for="useSubheader">Add Subheader Content</label>
                                    </div>
                                    <div class="form-group pt-2 collapse" id="subheader">
                                        <div class="btn-group btn-group-toggle pb-2" data-toggle="buttons">

                                            <label class="btn btn-outline-primary active p-0" id="subheader-left-button">
                                                <input type="radio" id="subheader-left" name="subheader-align" checked><span class="material-icons" aria-hidden="true">format_align_left</span>
                                            </label>
                                            <label class="btn btn-outline-primary p-0" id="subheader-center-button">
                                                <input type="radio" id="subheader-center" name="subheader-align"><span class="material-icons" aria-hidden="true">format_align_center</span>
                                            </label>        
                                            <label class="btn btn-outline-primary p-0" id="subheader-right-button">
                                                <input type="radio" id="subheader-right" name="subheader-align"><span class="material-icons" aria-hidden="true" aria-checked="">format_align_right</span>
                                            </label>    

                                        </div>
                                        <textarea class="form-control pv-2 pl-3 pr-2 mb-0 col-10" id="subheaderText" rows="2" placeholder='Add any subheader text here'></textarea>
                                    </div>

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="useLogo">
                                        <label class="custom-control-label" for="useLogo">Add Image <span style="color:red">(IN BETA)</span></label>
                                    </div>
                                    <div class="form-group collapse pt-2 pl-4" id="add-logo">   
                                        <label for="logo">Select an image to import:</label><br>
                                        <input type="file" accept='image/*' class="form-control-file pb-2" id="logo" name="logo"> 

                                        <label for="logoX">image-x (pt)</label><br>
                                        <input type="number" class="form-control-sm mb-2 col-4" id="logoX" value="36" step="1"><br>

                                        <label for="logoY">image-y (pt)</label><br>
                                        <input type="number" class="form-control-sm mb-2 col-4" id="logoY" value="36" step="1"><br>

                                        <label for="logoS">image size (%)</label><br>
                                        <input type="number" class="form-control-sm mb-2 col-4" id="logoS" value="100" step="1"><br>

                                    </div>  
  

                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div id="headingThree" class="card-header bg-white shadow-sm border-0">
               
                                    <a data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree" class="btn btn-link collapsed text-dark font-weight-bold text-uppercase collapsible-link">Basic Options</a>
                     
                            </div>
                            <div id="collapseThree" aria-labelledby="headingThree" data-parent="#accordionMain" class="collapse">
                                <div class="card-body mx-2 px-4 py-3">
                                    <div class="form-group">
                                        <label for="hFontSize">Main Header Font Size (pt)</label><br>
                                        <input type="number" class="form-control col-4" id="hFontSize" value="20">
                                    </div>
                                    <div class="form-group">
                                        <label for="h2FontSize">Right Header Font Size (pt)</label><br>
                                        <input type="number" class="form-control col-4" id="h2FontSize" value="16">
                                    </div>
                                    <div class="form-group" id="subheader-font-size">
                                        <label for="sFontSize">Subheader Font Size (pt)</label><br>
                                        <input type="number" class="form-control col-4" id="sFontSize" value="14">
                                    </div>
                                    <div class="form-group">
                                        <label for="cFontSize">Starting Clue Font Size (pt)</label><br>
                                        <input type="number" class="form-control col-4" id="cFontSize" value="14">
                                    </div>
                                    <div class="form-group">
                                        <label for="columns">Number of Columns</label>
                                        <br>
                                        <select class="form-control col-6" id="columns">
                                        <option value="auto" selected>Auto</option>
                                        <option value="2">2</option>
                                        <option value="3">3</option>
                                        <option value="4">4</option>
                                        <option value="5">5</option>
                                        <option value="6">6</option>
                                        <option value="new">New Page (BETA)</option>
                                        </select>
                                    </div>
                                    <div class="custom-control custom-switch">
                                        <input type="checkbox" class="custom-control-input" id="useCopyright" checked>
                                        <label class="custom-control-label" for="useCopyright">Include Copyright</label>
                                    </div>

                                    <textarea class="form-control mt-2 pv-2 pl-3 pr-2 col-10 collapse show" id="copyright" rows="2" placeholder='Empty field will default to copyright from puz file'></textarea>

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="grid_br">
                                        <label class="custom-control-label" for="grid_br">Align Grid to Bottom-Right</label>
                                    </div>   

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="grid_bl">
                                        <label class="custom-control-label" for="grid_bl">Align Grid to Bottom-Left</label>
                                    </div>   

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="gray">
                                        <label class="custom-control-label" for="gray">Inksaver Mode</label>
                                    </div>

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="shade">
                                        <label class="custom-control-label" for="shade">Replace Circles With Shade</label>
                                    </div>      
                                    
                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="solution">
                                        <label class="custom-control-label" for="solution">Print Solution in Grid</label>
                                    </div>

                                    <div class="custom-control custom-switch pt-2">
                                        <input type="checkbox" class="custom-control-input" id="remember">
                                        <label class="custom-control-label" for="remember">Remember Options <span style="color:red">(IN BETA)</span></label>
                                    </div>
                                    
                                    <div class="ml-1 pl-2 pt-1" id="remember-buttons">

                                        <button type="button" class="btn btn-outline-primary btn-sm mt-1 ml-4" id="save">Save Options</button>

                                        <button type="button" class="btn btn-outline-primary btn-sm mt-1 ml-1" id="clear">Clear Cache</button>

                                    </div>

                                    
                                </div>  
                            </div>
                        </div>


                        <div class="card">
                            <div id="headingFour" class="card-header bg-white shadow-sm border-0">
                 
                                    <a data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour" class="btn btn-link collapsed text-dark font-weight-bold text-uppercase collapsible-link">Advanced Options</a>
                            
                            </div>
                            <div id="collapseFour" aria-labelledby="headingFour" data-parent="#accordionMain" class="collapse">

                                <div class="card-body mx-2 px-4 pt-3 pb-1">
                                    

                                    <div class="accordion" id="accordionAdvanced">

                                        <div id="headingMargins" class="card-header bg-white m-0 p-0 border-0">
                                            <a data-toggle="collapse" data-target="#collapseMargins" aria-expanded="false" aria-controls="collapseMargins" class="btn btn-link text-left mx-1 mb-2 px-3 col-12 plus-link"><h6>Margins</h6></a>
                                        </div>
                                        <div id="collapseMargins" aria-labelledby="headingMargins" data-parent="#accordionAdvanced" class="collapse ml-3 px-3 border-left">
                                            <div class="form-group">
                                                 <label for="marginSize">Top Margin (in.) </label><br>
                                                 <input type="number" class="form-control-sm col-4" id="marginSize" value="0.5" step=".1">
                                            </div>
                                            <div class="form-group">
                                                <label for="bottommarginSize">Bottom Margin (in.) </label><br>
                                                <input type="number" class="form-control-sm col-4" id="bottommarginSize" value="0.5" step=".1">
                                           </div>
                                            <div class="form-group">
                                                <label for="sidemarginSize">Side Margins (in.) </label><br>
                                                <input type="number" class="form-control-sm col-4" id="sidemarginSize" value="0.5" step=".1">
                                           </div>
                                           <div class="form-group" id="useHeaderWidth">
                                                <label for="headerWidth">Main Header Text Width (%) </label><br>
                                                <input type="number" class="form-control-sm col-4" id="headerWidth" value="67" step="1">
                                            </div>   

                                        </div>

                                        <div id="headingPadding" class="card-header bg-white m-0 p-0 border-0">
                                            <a data-toggle="collapse" data-target="#collapsePadding" aria-expanded="false" aria-controls="collapsePadding" class="btn btn-link text-left mx-1 mb-2 px-3 col-12 plus-link"><h6>Padding</h6></a>
                                        </div>
                                        <div id="collapsePadding" aria-labelledby="headingPadding" data-parent="#accordionAdvanced" class="collapse ml-3 px-3 border-left">
                                            <div class="form-group">
                                                <label for="hsPadding">Header-Subheader Padding (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="hsPadding" value="4" step="1">
                                            </div>
                                            <div class="form-group">
                                                <label for="hbPadding">Header-Body Padding (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="hbPadding" value="12" step="1">
                                            </div>
                                            <div class="form-group">
                                                <label for="hlPadding">Header Left Padding (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="hlPadding" value="0" step="1">
                                            </div>
                                            <div class="form-group">
                                                <label for="slPadding">Subheader Left Padding (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="slPadding" value="0" step="1">
                                            </div>
                                            <div class="form-group">
                                                <label for="gridPadding">Grid Vertical Padding (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="gridPadding" value="20" step="1">
                                            </div>
                                            <div class="form-group">
                                                <label for="columnPadding">Gutter / Column Padding (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="columnPadding" value="10" step="1">
                                            </div>
                                        </div>

                                        <div id="headingFonts" class="card-header bg-white m-0 p-0 border-0">
                                            <a data-toggle="collapse" data-target="#collapseFonts" aria-expanded="false" aria-controls="collapseFonts" class="btn btn-link text-left mx-1 mb-2 px-3 col-12 plus-link"><h6>Fonts</h6></a>
                                        </div>
                                        <div id="collapseFonts" aria-labelledby="headingFonts" data-parent="#accordionAdvanced" class="collapse ml-3 px-3 border-left">
                                            <div class="custom-control custom-switch pb-2">
                                                <input type="checkbox" class="custom-control-input" id="useCustom">
                                                <label class="custom-control-label" for="useCustom">Add Custom Header Font</label>
                                            </div>
                                            <div class="form-group collapse c" id="add-custom-font">   
                                                <label for="customFont">Select a .ttf file to import:</label><br>
                                                <input type="file" accept='.ttf' class="form-control-file" id="customFont" name="customFont"> 
                                            </div>  
                                            <div class="form-group">
                                                <label for="headerFont">Header Font</label>
                                                <br>
                                                <select class="form-control" id="headerFont">
                                                <option value="RobotoCondensed" selected>Roboto Condensed</option>
                                                <option value="NunitoSans-Regular">Nunito Sans</option>
                                                <option value="helvetica">Helvetica</option>
                                                <option value="courier">Courier</option>
                                                <option value="times">Times New Roman</option>
                                                <option value="myFont" class="c">Custom Header Font</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="gridFont">Grid Font</label>
                                                <br>
                                                <select class="form-control" id="gridFont">
                                                <option value="RobotoCondensed">Roboto Condensed</option>
                                                <option value="NunitoSans-Regular" selected>Nunito Sans</option>
                                                <option value="helvetica">Helvetica</option>
                                                <option value="courier">Courier</option>
                                                <option value="times">Times New Roman</option>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <label for="clueFont">Clue Font</label>
                                                <br>
                                                <select class="form-control" id="clueFont">
                                                <option value="RobotoCondensed" selected>Roboto Condensed</option>
                                                <option value="NunitoSans-Regular">Nunito Sans</option>
                                                <option value="helvetica">Helvetica</option>
                                                <option value="courier">Courier</option>
                                                <option value="times">Times New Roman</option>
                                                </select>
                                            </div>
                                            <div class="form-group" id="add-bold-font">   
                                                <label for="boldFont">These settings require a <b>bold</b> style of your custom font.  Select the .ttf file to import:</label><br>
                                                <input type="file" accept='.ttf' class="form-control-file" id="boldFont" name="boldFont"> 
                                            </div> 
                                        </div>
 
                                        <div id="headingGrid" class="card-header bg-white m-0 p-0 border-0">
                                           <a data-toggle="collapse" data-target="#collapseGrid" aria-expanded="false" aria-controls="collapseGrid" class="btn btn-link text-left mx-1 mb-2 px-3 col-12 plus-link"><h6>Grid</h6></a>
                                        </div>
                                        <div id="collapseGrid" aria-labelledby="headingGrid" data-parent="#accordionAdvanced" class="collapse ml-3 px-3 border-left">
                                            <div class="form-group">
                                                <label for="numberSize">Number Size (% of sq. height)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="numberSize" value="30">
                                            </div>
                                            <div class="form-group">
                                                <label for="lineWidth">Line Width (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="lineWidth" value="0.4" step=".1">
                                            </div>
                                            <div class="form-group">
                                                <label for="borderWidth">Border Width (pt)</label><br>
                                                <input type="number" class="form-control-sm col-4" id="borderWidth" value="0.4" step=".1">
                                            </div>
                                        </div>

                                        <div id="headingClue" class="card-header bg-white m-0 p-0 border-0">
                                            <a data-toggle="collapse" data-target="#collapseClue" aria-expanded="false" aria-controls="collapseClue" class="btn btn-link text-left mx-1 mb-2 px-3 col-12 plus-link"><h6>Clues</h6></a>
                                         </div>
                                         <div id="collapseClue" aria-labelledby="headingClue" data-parent="#accordionAdvanced" class="collapse ml-3 px-3 pb-2 border-left">
                                            <div class="form-group">
                                                <label for="interSpacing">Min. Line Spacing Between Clues</label><br>
                                                <input type="number" class="form-control-sm col-4" id="interSpacing" value="1.3" step=".1" min="1.0">
                                            </div>
                                            <div class="custom-control custom-switch">
                                                <input type="checkbox" class="custom-control-input" id="boldHeadings" checked>
                                                <label class="custom-control-label" for="boldHeadings">Bold Headings</label>
                                            </div>
                                            <div class="custom-control custom-switch pt-2">
                                                <input type="checkbox" class="custom-control-input" id="boldNumbers" checked>
                                                <label class="custom-control-label" for="boldNumbers">Bold Numbers</label>
                                            </div>
                                         </div>


                                    </div>



                                </div>  
                            </div>
                        </div>

                        <div class="card">
                            <div class="btn-group p-2" role="group" aria-label="preview button">
                                <button class="btn btn-outline-primary col-6 mr-2" id="previewButton" type="button" onclick="handleFileSelect('preview');return false;">Preview PDF</button>

                                <button class="btn btn-outline-primary col-6" id="downloadButton" type="button" onclick="handleFileSelect('download');return false;">Download PDF</button>
                            </div>
                        </div>
                        

                        </div>

                    </form>
                
            </div>

        <div class = "col-12 col-lg-8" id="example1">

        </div>
    </div>

        <script src="/js/jquery-3.3.1.slim.min.js"></script>

        <script>
        var myFont = '';
        var boldFont = '';
        var logo;

        // hide unnecessary features unless user turns them on

        $('.c').hide();
        $('#add-bold-font').hide();
        $("#header-center-button").hide();
        $("#subheader-font-size").hide();
                
        function handleCustomFont(evt) {

            var fonts = evt.target.files; // FileList object
            
            // fonts is a FileList of File objects.
            for (var i = 0, f; f = fonts[i]; i++) {

                // Only process files under 2mb.
                if (f.size >= 2000000) {
                    alert('This file is too big.');
                    continue;
                }
                if (f) {
                    var reader = new FileReader();
                  
                    reader.onload = function (readerEvt) {

                        var binaryString = readerEvt.target.result;

                        if (evt.target.id == 'customFont') {
                            myFont = btoa(binaryString);
                        } else if (evt.target.id == 'boldFont') {
                            boldFont = btoa(binaryString);
                        } 
                    }
                } else { 
                    alert("Failed to load file");
                }

                reader.readAsBinaryString(f);

            }

        }

        function handleCustomImage(evt) {
            var images = evt.target.files; // FileList object
            
            // images is a FileList of File objects.
            for (var i = 0, f; f = images[i]; i++) {

                // Only process files under 2mb.
                if (f.size >= 2000000) {
                    alert('This file is too big.');
                    continue;
                }
                
                if (f) {
                    var reader = new FileReader();
                  
                    reader.onload = function (readerEvt) {

                        logo = readerEvt.target.result;
                    }
                } else { 
                    alert("Failed to load file");
                }

                reader.readAsDataURL(f);

            }
        }

        document.getElementById('customFont').addEventListener('change', handleCustomFont);
        document.getElementById('boldFont').addEventListener('change', handleCustomFont);
        document.getElementById('logo').addEventListener('change', handleCustomImage);

        if (window.localStorage.getItem('remember') == 'true') {
            loadOptions();
            $('#remember').prop("checked",true);
            $('#remember-buttons').show();       
        } else {
            $('#remember-buttons').hide();
        }

        $('#remember').change( function() {

            if ($('#remember').is(':checked')) {

                window.localStorage.setItem('remember','true');
                $('#remember-buttons').show();

            } else {

                window.localStorage.setItem('remember','false');
                $('#remember-buttons').hide();

            }
        });

        $('#clear').click(function() {
            window.localStorage.clear();
            $('#remember-buttons').hide();
            $('#remember').prop("checked",false);
        });

        $('#save').click(function() {
            saveOptions();
        });

        $('#useCustom').change( function() {
            if ($('#useCustom').is(':checked')) {
                $('.c').show();
                $('#headerFont option[value="myFont"]').prop('selected',true);
            } else {
                $('.c').hide();
                $('#headerFont option[value="RobotoCondensed"]').prop('selected',true);
            }
        });


        $('#clueFont').change( function() {
            if (this.value=="myFont" && (document.getElementById('boldHeadings').checked || document.getElementById('boldNumbers').checked)) {
                $('#add-bold-font').show();
            } else {
                $('#add-bold-font').hide();
            }
        });

        $('#useHeader2').change( function() {
            if ($('#useHeader2').is(':checked')) {
                $("#header-left").prop("checked",true).trigger("click");
                $("#header-center-button").hide();
                $("#useHeaderWidth").show();
                $('#additional-header').show();
            } else {
                $("#header-center-button").show();
                $("#useHeaderWidth").hide();
                $('#additional-header').hide();

            }
        });

        $('#useSubheader').change( function() {
            if ($('#useSubheader').is(':checked')) {
                $("#subheader-font-size").show();
                $("#subheader").show();
            } else {
                $("#subheader-font-size").hide();
                $("#subheader").hide();

            }
        });

        $('#useLogo').change( function() {
            if ($('#useLogo').is(':checked')) {
                $("#add-logo").show();
            } else {
                $("#add-logo").hide();

            }
        });

        $('#useCopyright').change( function() {
            if ($('#useCopyright').is(':checked')) {
                $("#copyright").show();
            } else {
                $("#copyright").hide();

            }
        });


        function saveOptions() {

            // write to localStorage

            // header content
            if ($('#header-center').is(':checked')) {
                window.localStorage.setItem('header-center','true');
            } else {
                window.localStorage.setItem('header-center','false');
            }

            window.localStorage.setItem('headerText',$('#headerText').val());


            if (!$('#useHeader2').is(':checked')) {
                window.localStorage.setItem('useHeader2','false');
            } else {
                window.localStorage.setItem('useHeader2','true');
            }

            if ($('#header2-left').is(':checked')) {
                window.localStorage.setItem('header2-left','true');
            } else {
                window.localStorage.setItem('header2-left','false');
            }

            if ($('#header2-top').is(':checked')) {
                window.localStorage.setItem('header2-top','true');
            } else {
                window.localStorage.setItem('header2-top','false');
            }

            if ($('#header2-middle').is(':checked')) {
                window.localStorage.setItem('header2-middle','true');
            } else {
                window.localStorage.setItem('header2-middle','false');
            }

            window.localStorage.setItem('headerText2',$('#headerText2').val());


            if ($('#useSubheader').is(':checked')) {
                window.localStorage.setItem('useSubheader','true');
            } else {
                window.localStorage.setItem('useSubheader','false');
            }

            if ($('#subheader-center').is(':checked')) {
                window.localStorage.setItem('subheader-center','true');
            } else {
                window.localStorage.setItem('subheader-center','false');
            }
            
            if ($('#subheader-right').is(':checked')) {
                window.localStorage.setItem('subheader-right','true');
            } else {
                window.localStorage.setItem('subheader-right','false');
            }

            window.localStorage.setItem('subheaderText',$('#subheaderText').val());


            // add image
            if ($('#useLogo').is(':checked')) {
                window.localStorage.setItem('useLogo','true');

                if (logo) {
                    window.localStorage.setItem('logo', logo);
                }

            } else {
                window.localStorage.setItem('useLogo','false');
            }

            window.localStorage.setItem('logoX',$('#logoX').val());
            window.localStorage.setItem('logoY',$('#logoY').val());
            window.localStorage.setItem('logoS',$('#logoS').val());
            
            // basic options
            window.localStorage.setItem('hFontSize',$('#hFontSize').val());
            window.localStorage.setItem('h2FontSize',$('#h2FontSize').val());
            window.localStorage.setItem('sFontSize',$('#sFontSize').val());
            window.localStorage.setItem('cFontSize',$('#cFontSize').val());
            window.localStorage.setItem('columns',$('#columns').val());


            if (!$('#useCopyright').is(':checked')) {
                window.localStorage.setItem('useCopyright','false');
            } else {
                window.localStorage.setItem('useCopyright','true');
            }

            if ($('#grid_br').is(':checked')) {
                window.localStorage.setItem('grid_br','true');
            }

            if ($('#grid_bl').is(':checked')) {
                window.localStorage.setItem('grid_bl','true');
            }

            if ($('#gray').is(':checked')) {
                window.localStorage.setItem('gray','true');
            }
            
            if ($('#shade').is(':checked')) {
                window.localStorage.setItem('shade','true');
            }

            if ($('#solution').is(':checked')) {
                window.localStorage.setItem('solution','true');
            }

            // advanced settings -- margins

            window.localStorage.setItem('marginSize',$('#marginSize').val());
            window.localStorage.setItem('bottommarginSize',$('#bottommarginSize').val());
            window.localStorage.setItem('sidemarginSize',$('#sidemarginSize').val());
            window.localStorage.setItem('headerWidth',$('#headerWidth').val());


            // advanced settings -- padding

            window.localStorage.setItem('hsPadding',$('#hsPadding').val());
            window.localStorage.setItem('hbPadding',$('#hbPadding').val());
            window.localStorage.setItem('hlPadding',$('#hlPadding').val());
            window.localStorage.setItem('slPadding',$('#slPadding').val());
            window.localStorage.setItem('gridPadding',$('#gridPadding').val());
            window.localStorage.setItem('columnPadding',$('#columnPadding').val());

            // advanced settings -- fonts

            if ($('#useCustom').is(':checked')) {
                window.localStorage.setItem('useCustom','true');

                if (myFont.length > 0) {
                    window.localStorage.setItem('myFont', myFont);
                }
            }

            window.localStorage.setItem('headerFont',$('#headerFont').val());
            window.localStorage.setItem('gridFont',$('#gridFont').val());
            window.localStorage.setItem('clueFont',$('#clueFont').val());


            // advanced settings -- grid

            window.localStorage.setItem('numberSize',$('#numberSize').val());
            window.localStorage.setItem('lineWidth',$('#lineWidth').val());
            window.localStorage.setItem('borderWidth',$('#borderWidth').val());
            
            // advanced settings -- clues

            window.localStorage.setItem('interSpacing',$('#interSpacing').val());

            if (!$('#boldHeadings').is(':checked')) {
                window.localStorage.setItem('boldHeadings','false');
            }

            if (!$('#boldNumbers').is(':checked')) {
                window.localStorage.setItem('boldNumbers','false');
            }


        } 

        function loadOptions() {
                
            // -- retrieve from storage --

            // header content

            if (window.localStorage.getItem('headerText')) {
                $('#headerText').val(window.localStorage.getItem('headerText'));
            }

            if (window.localStorage.getItem('useHeader2')=='false') {
                $('#useHeader2').prop("checked",false);
                $("#header-center-button").show();
                $("#useHeaderWidth").hide();
                $("#additional-header").hide();

                if (window.localStorage.getItem('header-center')=='true') {
                    $('#header-center').prop("checked",true);
                    $('#header-left-button').removeClass('active');
                    $('#header-center-button').addClass('active');
                } 
            }

            if (window.localStorage.getItem('header2-left')=='true') {
                    $('#header2-left').prop("checked",true);
                    $('#header2-right-button').removeClass('active');
                    $('#header2-left-button').addClass('active');
            } 

            if (window.localStorage.getItem('header2-top')=='true') {
                    $('#header2-top').prop("checked",true);
                    $('#header2-bottom-button').removeClass('active');
                    $('#header2-top-button').addClass('active');
            } 

            if (window.localStorage.getItem('header2-middle')=='true') {
                    $('#header2-middle').prop("checked",true);
                    $('#header2-bottom-button').removeClass('active');
                    $('#header2-middle-button').addClass('active');
            } 
            
            if (window.localStorage.getItem('headerText2')) {
                $('#headerText2').val(window.localStorage.getItem('headerText2'));
            }

            if (window.localStorage.getItem('useSubheader')=='true') {
                $('#useSubheader').prop("checked",true);
                $('#subheader').show();
            }

            if (window.localStorage.getItem('subheader-center')=='true') {
                $('#subheader-center').prop("checked",true);
                $('#subheader-left-button').removeClass('active');
                $('#subheader-center-button').addClass('active');
            }

            if (window.localStorage.getItem('subheader-right')=='true') {
                $('#subheader-right').prop("checked",true);
                $('#subheader-left-button').removeClass('active');
                $('#subheader-right-button').addClass('active');
            }

            if (window.localStorage.getItem('subheaderText')) {
                $('#subheaderText').val(window.localStorage.getItem('subheaderText'));
            }

            // add image

            if (window.localStorage.getItem('useLogo')=='true') {
                $('#useLogo').prop("checked",true);
                $('#add-logo').show();

                if (window.localStorage.getItem('logo')) {
                    logo = window.localStorage.getItem('logo');
                }

            }

            if ((window.localStorage.getItem('logoX') != '36') && (window.localStorage.getItem('logoX') != null)) {
                $('#logoX').val(window.localStorage.getItem('logoX'));
            }       
            
            if ((window.localStorage.getItem('logoY') != '36') && (window.localStorage.getItem('logoY') != null)) {
                $('#logoY').val(window.localStorage.getItem('logoY'));
            }     

            if ((window.localStorage.getItem('logoS') != '100') && (window.localStorage.getItem('logoS') != null)) {
                $('#logoS').val(window.localStorage.getItem('logoS'));
            }     



            // basic options
            if (window.localStorage.getItem('hFontSize')) {
                $('#hFontSize').val(window.localStorage.getItem('hFontSize'));
            }
                
            if (window.localStorage.getItem('h2FontSize')) {
                $('#h2FontSize').val(window.localStorage.getItem('h2FontSize'));
            }

            if (window.localStorage.getItem('sFontSize')) {
                $('#sFontSize').val(window.localStorage.getItem('sFontSize'));
            }
            
            if (window.localStorage.getItem('cFontSize')) {
                $('#cFontSize').val(window.localStorage.getItem('cFontSize'));
            }

            if (window.localStorage.getItem('columns')) {
                $('#columns').val(window.localStorage.getItem('columns'));
            }

            if (window.localStorage.getItem('useCopyright') == 'false') {
                $('#useCopyright').prop("checked",false);
            } else {
                $('#useCopyright').prop("checked",true);
            }

            if (window.localStorage.getItem('grid_br') == 'true') {
                $('#grid_br').prop("checked",true);
            }

            if (window.localStorage.getItem('grid_bl') == 'true') {
                $('#grid_bl').prop("checked",true);
            }

            if (window.localStorage.getItem('gray') == 'true') {
                $('#gray').prop("checked",true);
            }

            if (window.localStorage.getItem('shade') == 'true') {
                $('#shade').prop("checked",true);
            }

            if (window.localStorage.getItem('solution') == 'true') {
                $('#solution').prop("checked",true);
            }

            
            // advanced settings -- margins

            if (window.localStorage.getItem('marginSize')) {
                $('#marginSize').val(window.localStorage.getItem('marginSize'));
            }

            if (window.localStorage.getItem('bottommarginSize')) {
                $('#bottommarginSize').val(window.localStorage.getItem('bottommarginSize'));
            }

            if (window.localStorage.getItem('sidemarginSize')) {
                $('#sidemarginSize').val(window.localStorage.getItem('sidemarginSize'));
            }

            if (window.localStorage.getItem('headerWidth')) {
                $('#headerWidth').val(window.localStorage.getItem('headerWidth'));
            }

            // advanced settings -- padding

            if (window.localStorage.getItem('hsPadding')) {
                $('#hsPadding').val(window.localStorage.getItem('hsPadding'));
            }

            if (window.localStorage.getItem('hbPadding')) {
                $('#hbPadding').val(window.localStorage.getItem('hbPadding'));
            }

            if (window.localStorage.getItem('hlPadding')) {
                $('#hlPadding').val(window.localStorage.getItem('hlPadding'));
            }

            if (window.localStorage.getItem('slPadding')) {
                $('#slPadding').val(window.localStorage.getItem('slPadding'));
            }

            if (window.localStorage.getItem('gridPadding')) {
                $('#gridPadding').val(window.localStorage.getItem('gridPadding'));
            }

            if (window.localStorage.getItem('columnPadding')) {
                $('#columnPadding').val(window.localStorage.getItem('columnPadding'));
            }

            // advanced settings -- fonts

            if (window.localStorage.getItem('useCustom') == 'true') {
                $('#useCustom').prop("checked",true);
                $('.c').show();
                $('#headerFont option[value="myFont"]').prop('selected',true);

                if (window.localStorage.getItem('myFont')) {
                    myFont = window.localStorage.getItem('myFont');
                }

            }       

            if (window.localStorage.getItem('headerFont')) {
                $('#headerFont').val(window.localStorage.getItem('headerFont'));
            }

            if (window.localStorage.getItem('gridFont')) {
                $('#gridFont').val(window.localStorage.getItem('gridFont'));
            }

            if (window.localStorage.getItem('clueFont')) {
                $('#clueFont').val(window.localStorage.getItem('clueFont'));
            }

            // advanced settings -- grid

            if (window.localStorage.getItem('numberSize')) {
                $('#numberSize').val(window.localStorage.getItem('numberSize'));
            }

            if (window.localStorage.getItem('lineWidth')) {
                $('#lineWidth').val(window.localStorage.getItem('lineWidth'));
            }

            if (window.localStorage.getItem('borderWidth')) {
                $('#borderWidth').val(window.localStorage.getItem('borderWidth'));
            }

            // advanced settings -- clues

            if (window.localStorage.getItem('interSpacing')) {
                $('#interSpacing').val(window.localStorage.getItem('interSpacing'));
            }

            if (window.localStorage.getItem('boldHeadings') == 'false') {
                $('#boldHeadings').prop("checked",false);
            }

            if (window.localStorage.getItem('boldNumbers') == 'false') {
                $('#boldNumbers').prop("checked",false);
            }

        }


        function handleFileSelect(evt) {

            // get the address and e-mail
            var header_text = document.getElementById('headerText').value;
            var header2_text = document.getElementById('headerText2').value;
            var subheader_text = document.getElementById('subheaderText').value;
            var header_align = 'left';
            var header2_align = 'right';
            var subheader_align = 'left';
            var y_align = 'alphabetic';
            var gray = 0;
            var number = document.getElementById('numberSize').value;
            var clue_entry_pt = document.getElementById('cFontSize').value*1;
            var header_pt = document.getElementById('hFontSize').value*1;
            var header2_pt = document.getElementById('h2FontSize').value*1;
            var subheader_pt = document.getElementById('sFontSize').value*1;
            var margin = document.getElementById('marginSize').value*72;
            var side_margin = document.getElementById('sidemarginSize').value*72;
            var bottom_margin = document.getElementById('bottommarginSize').value*72;
            var header_width = document.getElementById('headerWidth').value*.01;
            var grid_padding = document.getElementById('gridPadding').value*1;
            var header_indent = document.getElementById('hlPadding').value*1;
            var subheader_indent = document.getElementById('slPadding').value*1;
            var subheader_mt = document.getElementById('hsPadding').value*1;
            var under_title_padding = document.getElementById('hbPadding').value*1;
            var line_width = document.getElementById('lineWidth').value*1;
            var border_width = document.getElementById('borderWidth').value*1;
            var column_padding = document.getElementById('columnPadding').value*1;
            var clue_spacing = document.getElementById('interSpacing').value-1;
            var heading_style = 'bold';
            var number_style = 'bold';
            var shade = false;
            var solution = false;
            var header_font = document.getElementById('headerFont').value;
            var grid_font = document.getElementById('gridFont').value;
            var clue_font = document.getElementById('clueFont').value;
            var right_header = true;
            var subheader = false;
            var copyright = true;
            var copyright_text = document.getElementById('copyright').value;
            var columns = document.getElementById('columns').value;
            var grid_placement = 'top';
            var logoX = document.getElementById('logoX').value*1;
            var logoY = document.getElementById('logoY').value*1;
            var logoS = document.getElementById('logoS').value/100;

            if (document.getElementById('grid_br').checked) {
                grid_placement = 'bottom';
            }

            if (document.getElementById('grid_bl').checked) {
                grid_placement = 'left';
            }
            
            if (document.getElementById('header-center').checked) {
                header_align = 'center';
            }

            if (document.getElementById('subheader-center').checked) {
                subheader_align = 'center';
            }

            if (document.getElementById('subheader-right').checked) {
                subheader_align = 'right';
            }

            if (!document.getElementById('useHeader2').checked) {
                right_header = false;
            }

            if (document.getElementById('useSubheader').checked) {
                subheader = true;
            }

            if (document.getElementById('header2-top').checked) {
                y_align = 'top';
            }

            if (document.getElementById('header2-middle').checked) {
                y_align = 'middle';
            }

            if (document.getElementById('header2-left').checked) {
                header2_align = 'left';
            }

            if (!document.getElementById('useCopyright').checked) {
                copyright = false;
            }

            if (!document.getElementById('boldHeadings').checked) {
                heading_style = 'normal';
            }

            if (!document.getElementById('boldNumbers').checked) {
                number_style = 'normal';
            }

            if (!document.getElementById('useCustom').checked) {
                document.getElementById('customFont').value = "";
            } 

            if (!document.getElementById('useLogo').checked) {
                logo = null;
            } 

            if (document.getElementById('gray').checked) {
                gray = 0.6;
            }
            
            if (document.getElementById('shade').checked) {
                shade = true;
            }

            if (document.getElementById('solution').checked) {
                solution = true;
            }

            var files = document.getElementById('files').files; // FileList object
            
            if (!files[0]) {
                alert('Please choose a puzzle file.');
                return;    
            }

            // files is a FileList of File objects.
            for (var i = 0, f; f = files[i]; i++) {

                // Only process small files.
                if (f.size >= 2000000) {
                    alert('This file is too big.');
                    continue;
                }
                if (f) {
                    var r = new FileReader();
                    var filename = f.name;
                    filename = filename.substring(0,filename.length - 4);
                    var outname = filename + '.pdf';
                    r.onload = (function(theFile) {
                        return function(e) { 
                            var contents = e.target.result;     
                            //var puzdata = PUZAPP.parsepuz(contents);
                            var xw_constructor = new JSCrossword();
                            var puzdata = xw_constructor.fromData(contents);
                            var options = {outfile: outname, header_text: header_text, header2_text: header2_text, header_align: header_align, header2_align: header2_align, y_align: y_align, gray: gray, output: evt, number_pct: number, margin: margin, side_margin: side_margin, bottom_margin: bottom_margin, max_clue_pt: clue_entry_pt, header_pt: header_pt, header2_pt: header2_pt, grid_padding: grid_padding, line_width: line_width, border_width: border_width, column_padding: column_padding, clue_spacing:clue_spacing, heading_style: heading_style, number_style: number_style, shade: shade, my_font: myFont, bold_font: boldFont, header_font: header_font, grid_font: grid_font, clue_font: clue_font, right_header: right_header, subheader: subheader, subheader_text: subheader_text, subheader_pt: subheader_pt, subheader_align: subheader_align, copyright: copyright, copyright_text: copyright_text, subheader_mt: subheader_mt, under_title_spacing: under_title_padding, header_width: header_width, columns:columns, grid_placement: grid_placement, solution: solution, logo: logo, logoX: logoX, logoY: logoY, logoS:logoS, header_indent: header_indent, subheader_indent: subheader_indent};
                            puzdata_to_pdf(puzdata,options);
                        };
                    })(f);
                    r.readAsBinaryString(f);
                    document.querySelector('#previewButton').textContent = 'Update Preview';
                } else { 
                    alert("Failed to load file");
                }
            }


        }

        </script>

        <p>
        <hr/>
        Original code from
        <a
          href="https://crosswordnexus.com/apps/puz-to-nyt/"
          >Crossword Nexus</a>, licensed under MIT License.
        <br>
        
      </p>
    </div>

    <script src="js/jspdf.umd.min.js"></script>
    <script src="js/RobotoCondensed-normal.js"></script>
    <script src="js/RobotoCondensed-bold.js"></script>
    <script src="js/NunitoSans-Regular-normal.js"></script>
    <script src="js/NunitoSans-Regular-bold.js"></script>
    <script src="js/jscrossword_combined.js" type="text/javascript"></script>
    <script src="js/puz_functions.js" type="text/javascript"></script>
    <script src="js/pdfobject.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>

  </body>
</html>
